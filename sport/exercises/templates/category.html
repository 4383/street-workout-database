{% extends "common/base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load static %}
{% get_media_prefix as MEDIA_PREFIX %}
{% load exercises_tags %}

{% block title %}{{ category|capfirst }} {% trans "Category" %}{% endblock %}
{% block meta_description %}{{ category.common_page_attribute.description }}{% endblock %}
{% block meta_keywords %}{{ category.common_page_attribute.keywords }}{% endblock %}

{% block main_menu_exercises_active %}
<li class="dropdown active">
{% endblock %}

{% block content %}
    <ol class="breadcrumb">
        <li><a href="{% url 'exercises_categories' %}">{% trans "Categories" %}</a></li>
        <li>{{ category|capfirst }}</li>
        <li class="active">{% trans "Description" %}</li>
    </ol>
    <h1>
        {{ category|capfirst }} {% trans "Category" %}
    </h1>

    {% show_exercises_category_menu category "description" %}

    {% if mapping %}
    <section class="right right-spaced-xl panel panel-default padding-xl" id="muscles">
        <script>
            {% for muscle in muscles_list %}
                {% if muscle.area %}
                    {% for area in muscle.area %}
                        {% if area.mapping == mapping %}
                            {% if forloop.first %}
                                var gallery_content = '{' +
                            {% endif %}
                            '"{{ area.name }}" : {"image1" : "{% get_media_prefix %}{{ area.first_image_hover }}", ' +
                            '"image2" : "{% get_media_prefix %}{{ area.second_image_hover }}", ' +
                            '"muscle" : "{{ muscle.muscle }}"}' +
                            {% if not forloop.last %}
                                ',' +
                            {% else %}
                                '}';
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}

            var json_images_data = JSON.parse(gallery_content);

            var MappingManager = MappingManager || {};
            MappingManager.Mapping = function() {

                var overArea = function(area_id) {
                    console.log(area_id);
                    image = json_images_data[area_id]['image2'];
                    muscle_link = json_images_data[area_id]['muscle'] + '_link';
                    console.log(image);
                    document.getElementById(area_id + "_img").src = image;
                    document.getElementById(muscle_link).className = "btn btn-xs btn-danger";
                };

                var outArea = function(area_id) {
                    console.log(area_id);
                    image = json_images_data[area_id]['image1'];
                    muscle_link = json_images_data[area_id]['muscle'] + '_link';
                    console.log(image);
                    document.getElementById(area_id + "_img").src = image;
                    document.getElementById(muscle_link).className = "btn btn-xs btn-success";
                };

                var oPublic = {
                    overArea: overArea,
                    outArea: outArea
                }

                return oPublic;
            }();
        </script>
        <div class="panel-body"
             style="background: url('{% get_media_prefix %}{{ mapping.image }}') no-repeat;
                     min-height: {{ mapping.height }}px;
                     width: {{ mapping.width }}px;
                     position: relative;">
            {% for muscle in muscles_list %}
                {% if muscle.area %}
                    {% for area in muscle.area %}
                        {% if area.mapping == mapping %}
                            <img src="{% get_media_prefix %}{{ area.first_image_hover }}"
                                 class="superposition hand-cursor"
                                 id="{{ area.name }}_img"
                                 style="z-index: {{ forloop.counter }};"/>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}

            <img usemap="#{{ mapping.name }}" alt="{{ mapping.alt }}"
                 style="z-index: 1000; min-height: {{ mapping.height }}; width: {{ mapping.width }};"
                 class="superposition"
                 src="{% get_media_prefix %}{{ mapping.transparent_image }}">

            <map name="{{ mapping.name }}">
                {% for muscle in muscles_list %}
                    {% if muscle.area %}
                        {% for area in muscle.area %}
                            {% if area.mapping == mapping %}
                                <area shape="poly"
                                      href="{% url 'exercises_muscle' slug=muscle.muscle.slug %}"
                                      coords="{{ area.points }}"
                                      id="{{ area.name }}"
                                      class="mapping_area">
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            </map>
            <script>

            $('.mapping_area').mouseover(function (event) {
                area_id = event.target.id;
                MappingManager.Mapping.overArea(area_id);
            });

            $('.mapping_area').mouseout(function (event) {
                area_id = event.target.id;
                MappingManager.Mapping.outArea(area_id);
            });
            </script>
        </div>
        <p>
            {% for muscle in muscles_list %}
                <a id="{{ muscle.muscle }}_link"
                   class="btn btn-xs btn-success"
                   href="{% url 'exercises_muscle' slug=muscle.muscle.slug %}">{{ muscle.muscle }}</a>
            {% endfor %}
        </p>
    </section>
    {% endif %}

    {% if main_image %}
        <section class="right right-spaced-xl panel panel-default padding-xl left-spaced-xl" id="media">
            <img class="img-xl"
                 src="{% get_media_prefix %}{{ main_image.image }}"
                 alt="{{ main_image.alt }}"
                 title="{{ main_image.name }}" />
        </section>
    {% endif %}

    <section id="description">
        <p class="text-justify text-xl">{{ category.description|capfirst }}</p>
    </section>

    {% if category.related_category.all %}
        <hr>
        <section id="related-categories">
            <h4><u>{% trans "Related Categories" %}</u></h4>
            {% for related_category in category.related_category.all %}
                <a href="{% url 'exercises_category' slug=related_category.slug %}"
                class="btn btn-success">{{ related_category|capfirst }}</a>
            {% endfor %}
        </section>
    {% endif %}
{% endblock %}<!-- End Content -->